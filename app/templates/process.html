{% extends 'base.html' %}

{% block title %}Workspace – {{ file.name }}{% endblock %}

{% block content %}
<div class="container" style="max-width:900px; margin:40px auto;">
  <div style="display:flex; justify-content:space-between; align-items:center;">
    <h1>Workspace – {{ file.name }}</h1>
    <a href="{{ url_for('uploads.datasets_index') }}" class="button go-back">Back to Uploads</a>
  </div>

  <div class="viewer" style="margin-top:20px; text-align:center;">
    <img src="data:image/png;base64,{{ img }}" alt="Processed image" style="max-width:100%; height:auto;">
  </div>

  <form action="{{ url_for('uploads.apply_filter', file_id=file.id) }}" method="POST" style="margin-top:20px; display:flex; gap:10px; flex-wrap:wrap;">
    {% for name in filter_names %}
      <button
        type="submit"
        name="filter_name"
        value="{{ name }}"
        {% if name not in allowed_filters %}disabled{% endif %}
        class="button filter-btn"
        style="margin:5px;"
      >
        {{ name }}
      </button>
    {% endfor %}
  </form>

  <div style="margin-top:20px;">
    <form action="{{ url_for('uploads.undo', file_id=file.id) }}" method="GET" style="display:inline;">
      <button type="submit" class="button">Undo</button>
    </form>
    <form action="{{ url_for('uploads.reset', file_id=file.id) }}" method="GET" style="display:inline; margin-left:10px;">
      <button type="submit" class="button">Reset</button>
    </form>
    <form action="{{ url_for('uploads.download_processed', file_id=file.id) }}" method="GET" style="display:inline; margin-left:10px;">
      <button type="submit" class="button">Download</button>
    </form>
  </div>

  <div style="margin-top:30px;">
    <h2>Other Files</h2>
    <div style="display:flex; flex-wrap:wrap; gap:10px; margin-top:10px;">
      {% for f in files %}
      <a href="{{ url_for('uploads.process', file_id=f.id) }}">
        <img
          src="{{ url_for('uploads.serve_dataset_file',
                          ds_id=file.dataset_id,
                          filename=f.path) }}"
          alt="{{ f.name }}"
          style="width:80px; height:80px; object-fit:cover; border:2px solid #ccc;"
        >
      </a>
    {% endfor %}
    </div>
  </div>
</div>
{% endblock %}
